DECLARE @CurrentMigration [nvarchar](max)

IF object_id('[dbo].[__MigrationHistory]') IS NOT NULL
    SELECT @CurrentMigration =
        (SELECT TOP (1) 
        [Project1].[MigrationId] AS [MigrationId]
        FROM ( SELECT 
        [Extent1].[MigrationId] AS [MigrationId]
        FROM [dbo].[__MigrationHistory] AS [Extent1]
        WHERE [Extent1].[ContextKey] = N'StocksData.Migrations.Configuration'
        )  AS [Project1]
        ORDER BY [Project1].[MigrationId] DESC)

IF @CurrentMigration IS NULL
    SET @CurrentMigration = '0'

IF @CurrentMigration < '201802101405485_Initial'
BEGIN
    CREATE TABLE [dbo].[Companies] (
        [Ticker] [nvarchar](128) NOT NULL,
        CONSTRAINT [PK_dbo.Companies] PRIMARY KEY ([Ticker])
    )
    CREATE TABLE [dbo].[StockQuotes] (
        [Ticker] [nvarchar](128) NOT NULL,
        [Date] [int] NOT NULL,
        [Open] [float] NOT NULL,
        [High] [float] NOT NULL,
        [Low] [float] NOT NULL,
        [Close] [float] NOT NULL,
        [Volume] [float] NOT NULL,
        CONSTRAINT [PK_dbo.StockQuotes] PRIMARY KEY ([Ticker], [Date])
    )
    CREATE INDEX [IX_Ticker] ON [dbo].[StockQuotes]([Ticker])
    ALTER TABLE [dbo].[StockQuotes] ADD CONSTRAINT [FK_dbo.StockQuotes_dbo.Companies_Ticker] FOREIGN KEY ([Ticker]) REFERENCES [dbo].[Companies] ([Ticker]) ON DELETE CASCADE
    CREATE TABLE [dbo].[__MigrationHistory] (
        [MigrationId] [nvarchar](150) NOT NULL,
        [ContextKey] [nvarchar](300) NOT NULL,
        [Model] [varbinary](max) NOT NULL,
        [ProductVersion] [nvarchar](32) NOT NULL,
        CONSTRAINT [PK_dbo.__MigrationHistory] PRIMARY KEY ([MigrationId], [ContextKey])
    )
    INSERT [dbo].[__MigrationHistory]([MigrationId], [ContextKey], [Model], [ProductVersion])
    VALUES (N'201802101405485_Initial', N'StocksData.Migrations.Configuration',  0x1F8B0800000000000400CD59CD6EE33610BE17E83B083A1659CB712E5BC3DE45EA246DD075BC8D9DA0B78096C632118A54492AB551F4C97AE823F5153AFAB54459F24FB249904B44CE7C1C0EBF19CED0FFFDF3EFE0F32A60D6134845051FDAA79DAE6D01778547B93FB423BDF8F0D1FEFCE9FBEF06975EB0B2EE73B9B3580E35B91ADA4BADC3BEE328770901519D80BA5228B1D01D57040EF184D3EB767F744E4F1D40081BB12C6B701B714D03483EF07324B80BA18E081B0B0F98CAC671669AA05A37240015121786F6540BF7515D104D3AA8A661A5956D9D334AD09429B0856D11CE85261A0DEDDF29986A29B83F0D7180B0D93A04945B10A620DB407F23BEEF5EBABD782FCE4631877223A5457020E0E959E61CC7543FCAC576E13C74DF25BA59AFE35D272E1CDA23118484AF6DCB5CAB3F623296AB3838398D4EA6736299332705219037F1DF89358A988E240C39445A1294F81ACD19757F85F54C3C021FF288B1B2856823CE550670E8AB142148BDBE854566F78CBA8F206DCBA9EA3AA672A16AE8E55B93C86BDB1A93D517E0BE5E22E37B1F6DEB8AAEC0CB473272DC718A61804A5A46F879838693398362DEB0E4863C513FF1A461C16F91D08014BD05964CAB250D53A6E68E7DC845AEA4086E05DB1C5336F33015917471CD99D83A3D23D2075D3569E06CCEBE9511C9A12640079162A3F60E79B15514EDAB1FDBFB2190B16E6A6DBAEA35D767BD83112621F01CE142A0BB0F37E217EA2F9F09F145FCF94C8411130A9E89712F58141C06D21440E74A099726E151CDA97918570DB9E49ED51ED329B14AF900E985D142438C0F5C1F19669BE49EF00B60A0C13A77D36B6644944BBC2DF4C6E5F7B4274F22257BCAA9A16AD20FB59530CE40028F2F59BC96150639E5BA1E9494BB3424ACD52586D66171EF146B9833178001E1A189ADFB7FDEE2C51AC631ECF2CEC029D1AA9EAEE3420735409673F6E5624C7D99686485D096048E055096C35596884C3AC4F853D065E4D43314547E316D22C164AAB3075C234A995F0650C91D1B34F3BE2C096DBF51CDF3D9198C85FD4D9EA81DF9CE783221B723550880C25B125141824D75ECA4E5715E463B0D75F4604CC210EFAD525D9D8D58D3B4A81E7D981E5E6C062986E3AA2D3567616DB1921692F860CCC66EF3E08A4AA5E3FA614EE2343CF2829A5813E51BF897AFDAC2EAFA49E6F4CC95E3FF4B00D5A6A388817AC6C8F4AF70BF419C6FE2AD4389078D9A49C34318910D45C828BEC6787B128A796018504B53B5ADD66E8DAA1BF777F20BF9B694190E776F9BF2CB78B809252DDACA18DB8ACE3684B4682B23A423FB23A4355B19211DD91F2129D9CA00C9C0FEFA59C15646C886F6C7C80BB632483EF6CA8CAFE55F53A458BDC8C346BE1D64B96FF7E3462D19A622B685EE79A25E9208D74A43D049E265FA071B318AFBDD088C31C52D40E9B4ADB27BDDD39EF13CF27E9E2A1CA53CB6DF7BC59B3D19F02722DD2591F59EEFA8EEA1ADFD7EFFEDEFC619B542F31ACBDED5D0FE2BD1EB5BD7BF3FA4AA27D644222DFB56D7FAFB401FB637C53466FD335AE20513E4708472477C1C42A9213E0EA0D20F1F07516D87F7C1F856DDF01BF6BFE5EEE30D9ADED76A735B4BA977D8DBD6FB81F616B3204D73939A5EA243DB9B0B3CEA94E3453770400FBBA385DDB64C5BCBF74A3D6EA5056D68DC1B03637B59FD4D9AD77A9184DC2AFD4E84CC56D4DF40C4BF1A71702BAC2A64AEF942E4E4362CCA458C9C38064D3CA4DCB9D474415C8DD32E28953CF7DE1316A1C8653007EF9A4F221D461AB70CC19C555C190749DBFA49875EB5793009935F055E620B6826C52DC084FF1451E615765F6DC9E70D1071F4FD0C389E9E2506B3067F5D20DD08BE2750E6BE2269CC20081982A9099F922738C6B63B055FC027EE3AAF759B41761F44D5ED830B4A7C490295616CF4F11339EC05AB4FFF03FA3E4DAA2E1D0000 , N'6.2.0-61023')
END

